{% extends 'base.html' %}

{% block title %}
  安全设置
{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}" />
{% endblock %}

{% block content %}
  <div class="dashboard-container">
    <!-- 主内容区 -->
    <main class="main-content" id="mainContent">
      <!-- 顶栏 -->
      <header class="top-navbar">
        <div class="navbar-container">
          <div class="left-section">
            <div class="project-logo" id="projectLogo">
              <div class="logo-circle">Z</div>
              <span>ZZH-Tool</span>
            </div>
          </div>

          <div class="right-section">
            <div class="user-dropdown" id="userDropdown">
              <div class="user-info" id="userInfo">
                <!-- 修改这里：根据头像信息显示头像 -->
                {% if user_info.avatar %}
                  <img src="{{ url_for('get_avatar', filename=user_info.avatar) }}" alt="头像" class="user-avatar-img" />
                {% else %}
                  <div class="user-avatar-text">{{ user_info.username|first|upper }}</div>
                {% endif %}
                <span>{{ user_info.username }}</span>
                <i class="fas fa-chevron-down"></i>
              </div>

              <div class="dropdown-menu" id="dropdownMenu">
                <div class="dropdown-header">
                  <!-- 修改这里：根据头像信息显示头像 -->
                  {% if user_info.avatar %}
                    <img src="{{ url_for('get_avatar', filename=user_info.avatar) }}" alt="头像" class="dropdown-avatar-img" />
                  {% else %}
                    <div class="dropdown-avatar-text">{{ user_info.username|first|upper }}</div>
                  {% endif %}
                  <div>
                    <h3>{{ user_info.username }}</h3>
                    <p>{{ user_info.email }}</p>
                  </div>
                </div>

                <div class="dropdown-divider"></div>

                <a href="/profile" class="dropdown-item">
                  <i class="fas fa-user"></i>
                  <span>个人资料</span>
                </a>

                <a href="/account_settings" class="dropdown-item">
                  <i class="fas fa-cog"></i>
                  <span>账户设置</span>
                </a>

                <a href="/security_settings" class="dropdown-item">
                  <i class="fas fa-shield-alt"></i>
                  <span>安全设置</span>
                </a>

                <div class="dropdown-divider"></div>

                <a href="/logout" class="dropdown-item logout">
                  <i class="fas fa-sign-out-alt"></i>
                  <span>退出登录</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- 安全设置内容 -->
      <div class="dashboard-content">
        <div class="profile-container">
          <div class="section-card">
            <div class="section-header">
              <i class="fas fa-shield-alt"></i>
              <h2>安全设置</h2>
            </div>

            <div class="security-item">
              <div class="security-icon">
                <i class="fas fa-lock"></i>
              </div>
              <div class="security-details">
                <h3>密码 <span class="status-badge status-active">已设置</span></h3>
                <p>上次更新：{{ user_info.password_update_date }}</p>
              </div>
              <div class="security-action">
                <button class="btn btn-secondary" id="changePasswordBtn"><i class="fas fa-edit"></i> 更改密码</button>
              </div>
            </div>

            <div class="security-item">
              <div class="security-icon">
                <i class="fas fa-mobile-alt"></i>
              </div>
              <div class="security-details">
                <h3>双重验证 <span class="status-badge status-inactive">未启用</span></h3>
                <p>增强账户安全性，需要手机验证</p>
              </div>
              <div class="security-action">
                <button class="btn btn-secondary"><i class="fas fa-plus"></i> 启用</button>
              </div>
            </div>

            <div class="security-item">
              <div class="security-icon">
                <i class="fas fa-desktop"></i>
              </div>
              <div class="security-details">
                <h3>登录设备</h3>
                <p>{{ user_info.device_count }}台设备，最近登录：{{ user_info.last_login }}</p>
              </div>
              <div class="security-action">
                <button class="btn btn-secondary"><i class="fas fa-list"></i> 查看</button>
              </div>
            </div>

            <div class="security-item">
              <div class="security-icon">
                <i class="fas fa-history"></i>
              </div>
              <div class="security-details">
                <h3>登录历史</h3>
                <p>最近30天有{{ user_info.login_count }}次登录记录</p>
              </div>
              <div class="security-action">
                <button class="btn btn-secondary"><i class="fas fa-eye"></i> 查看记录</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- 更改密码模态框 -->
  <div class="modal" id="passwordModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>更改密码</h3>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="passwordForm">
          <div class="form-group">
            <label for="oldPassword">当前密码</label>
            <input type="password" id="oldPassword" class="form-control" required />
          </div>

          <div class="form-group">
            <label for="newPassword">新密码</label>
            <input type="password" id="newPassword" class="form-control" required />
          </div>

          <div class="form-group">
            <label for="confirmPassword">确认新密码</label>
            <input type="password" id="confirmPassword" class="form-control" required />
          </div>

          <div class="password-strength">
            <div class="strength-bar">
              <div class="strength-level" id="strengthLevel"></div>
            </div>
            <div class="strength-text" id="strengthText">密码强度：弱</div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelPassword">取消</button>
        <button class="btn btn-primary" id="savePassword">保存新密码</button>
      </div>
    </div>
  </div>
  <script src="{{ url_for('static', filename='js/profile.js') }}"></script>
{% endblock %}

